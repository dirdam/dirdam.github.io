<!-- Copyright (c) Adrián Jiménez Pascual -  All rights reserved -->
<!-- This page and its content is protected under copyright and intellectual property laws.  -->
<!-- The content belongs to Adrián Jiménez Pascual, Tokio, Japan -->
<!-- All rights reserved. -->
<!--
  **  Lawbreakers will be reported to competent authorities and sentenced by the law   **
-->
<!--Copyright (c) Adrián Jiménez Pascual - http://www.ms.u-tokyo.ac.jp/~adri/ -->

<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="viewport" content="width=device-width, user-scalable=no">
<link rel="shortcut icon" href="../Lasso_logo.ico"/>

<title>Verde</title>

<script>
var Point = function(x, y) {
	this.x = x;
	this.y = y;
}
Point.prototype.draw = function(number) {
	context.fillStyle = "black";
	var radius = 3;
	context.beginPath();
	context.arc(this.x, this.y, radius, 0, 2*Math.PI);
	context.fill();
	context.font = radius*4 + "px Verdana";
	context.fillText(number, this.x - context.measureText(number).width/2, this.y + radius*6);
}

var menu = 0
var col1 = "chartreuse"; var col2 = "yellowgreen";
onload = function() {
	var pass = prompt("Contraseña:");
	while (pass != "18523647I" && pass != "18523647i") {
		pass = prompt("Contraseña incorrecta. Nuevo intento:");
	}
	//Canvas
	canvas = document.createElement("canvas");
	document.body.appendChild(canvas);
	canvas.style.position = "absolute"; canvas.style.left = 0; canvas.style.top = 0;
    canvas.width = innerWidth; canvas.height = innerHeight;
	context = canvas.getContext("2d");

	draw_background(col1);
}

var draw_background = function(col) {
	context.fillStyle = col;
	context.fillRect(0, 0, canvas.width, canvas.height);
}

var draw_buttons = function() {
	context.fillStyle = col2;
	context.fillRect(0, canvas.height*9/10, canvas.width, canvas.height/10);
	context.lineWidth = 8;
	// Left arrow
	context.strokeStyle = "black";
	context.beginPath();
	context.moveTo(canvas.width*1/6, canvas.height - canvas.height/20);
	context.lineTo(canvas.width*2/6, canvas.height - canvas.height/20);
	context.moveTo(canvas.width*5/24, canvas.height - canvas.height/20 - canvas.height/40);
	context.lineTo(canvas.width*1/6, canvas.height - canvas.height/20);
	context.lineTo(canvas.width*5/24, canvas.height - canvas.height/20 + canvas.height/40);
	// Right arrow
	context.moveTo(canvas.width - canvas.width*1/6, canvas.height - canvas.height/20);
	context.lineTo(canvas.width - canvas.width*2/6, canvas.height - canvas.height/20);
	context.moveTo(canvas.width - canvas.width*5/24, canvas.height - canvas.height/20 - canvas.height/40);
	context.lineTo(canvas.width - canvas.width*1/6, canvas.height - canvas.height/20);
	context.lineTo(canvas.width - canvas.width*5/24, canvas.height - canvas.height/20 + canvas.height/40);
	context.stroke();
	context.beginPath();
	context.lineWidth = 3;
	context.moveTo(0, canvas.height*9/10);
	context.lineTo(canvas.width, canvas.height*9/10);
	context.moveTo(canvas.width/2, canvas.height*9/10);
	context.lineTo(canvas.width/2, canvas.height);
	context.stroke();
	// Text
	/*context.fillStyle = "black";
	context.font = canvas.height/25 + "px Verdana";
	context.fillText("(" + menu + ")", canvas.width/2 - canvas.width/16 - context.measureText("(" + menu + ")").width/2, canvas.height - canvas.height/20 + canvas.height/100);
	context.fillText("(" + (texts.length - menu - 1) + ")", canvas.width/2 + canvas.width/16 - context.measureText("(" + (texts.length - menu - 1) + ")").width/2, canvas.height - canvas.height/20 + canvas.height/100);*/
}

var sol = "MICROONDAS";
var attempt = "AAAAAAAAAA";
var texts = [["Ola, soi Papá Noé."],
		[""],
		["Tienes que adivinar una", "palabra de " + sol.length + " letras."],
		["El número que aparece abajo", "es la distancia a la que", "estás de la solución."],
		['Por ejemplo, "hola" está a 5 de', 'distancia de "cola", porque', '"h" y "c" están a esa distancia.'],
		["No vayas al lugar de la solución", "antes de escribirla completamente."],
		["Hay más instrucciones que", "tendrás que leer antes de ir."],
		[""],
		["¡Muy bien!", "Pues esa NO es tu clave.", "Tu clave la tiene Germán :P"]];
var draw_text = function() {
	draw_background(col1);
	draw_buttons();
	context.font = canvas.height/15 + "px Verdana";
	context.fillStyle = "black";
	for (var i = 0; i < texts[menu].length; i++) {
	    context.fillText(texts[menu][i], canvas.width/2 - context.measureText(texts[menu][i]).width/2, canvas.height*3/6 + (i < (texts[menu].length - 1)/2 ? -1 : 1)*Math.ceil(Math.abs(i - (texts[menu].length - 1)/2))*(canvas.height/6)/2);
	}
}

var draw_image = function() {
	var img = new Image();
	img.onload = function() {
		context.drawImage(img, canvas.width/6, canvas.height*1.5/10, canvas.width*2/3, canvas.height*3/5);
	}
	img.src = "olakease.jpg";
}

var draw_game = function() {
	draw_background(col1);
	context.font = canvas.height/10 + "px Verdana";
	context.fillStyle = "black";
	context.fillText(reshape(attempt), canvas.width/2 - context.measureText(reshape(attempt)).width/2, canvas.height*3/6);
	context.fillStyle = (dist_words(attempt, sol) == 0 ? "red" : "black");
	context.fillText((dist_words(attempt, sol) == 0 ? "Correcto" : dist_words(attempt, sol)), canvas.width/2 - context.measureText((dist_words(attempt, sol) == 0 ? "Correcto" : dist_words(attempt, sol))).width/2, canvas.height*5/6);
}

ontouchstart = function(event) {
	var x = event.touches[0].clientX;
	var y = event.touches[0].clientY;
	commonStart(x, y);
}

ontouchmove = function(event) {
	event.preventDefault();
}

onmousedown = function(event) {
	var x = event.clientX;
	var y = event.clientY;
	commonStart(x, y);
}

var order = 0;
var first = true;
var in_game = false;
function commonStart(x, y) {
	if (first) {
		draw_text();
		first = false;
	}
	else if (menu < texts.length){
		if (y > canvas.height*9/10 && !in_game) {
			if (x < canvas.width/2) {
				menu = Math.max(0, menu - 1);
			}
			else {
				menu = Math.min(texts.length - 1, menu + 1);
			}
			if (menu != texts.length - 2) {
				draw_text();
				if (menu == 1) {
					draw_image();
				}
			}
			else {
				in_game = true;
				draw_game();
				/*
				draw_background(col1);
				var sol = "revistero";
				var attempt = prompt("_ _ _ _ _ _ _ _ _ \n\nPalabra de 9 letras:");
				var dist = dist_words(attempt, sol);
				while (dist != 0) {
					attempt = prompt(correct(attempt, sol) + "\n\nDistancia a la palabra correcta: " + dist + ".\n\nPalabra de 9 letras:", (attempt == null ? "zorrooooo" : attempt));
					dist = dist_words(attempt, sol);
				}
				draw_text();
				*/
			}
		}
		else if (in_game) {
			var unit_x = context.measureText(reshape(attempt)).width/sol.length;
			var but_x = Math.floor((x - (canvas.width/2 - context.measureText(reshape(attempt)).width/2))/unit_x);
			var replacement = String.fromCharCode(65 + (attempt[but_x].charCodeAt(0) + (y > canvas.height/2 ? -1 : 1) - 65 + 26)%26);
			attempt = attempt.substr(0, but_x) + replacement + attempt.substr(but_x + replacement.length);
			draw_game();
			if (dist_words(attempt, sol) == 0) { // If found, show lower buttons
				in_game = false;
				draw_buttons();
			}
		}
	}
}

function distance(x1, y1, x2, y2) {
	return Math.sqrt((x1 - x2)*(x1 - x2) + (y1 - y2)*(y1 - y2));
}

function dist_words(w1, w2) {
	if (w1 == null) {
		alert("Ese señor mayor ahí, dándole a Cancelar...\nPues se siente pero hay que jugar hasta que aciertes, sinvergüenza.");
		return 27*w2.length;
	}
	var mini = Math.min(w1.length, w2.length);
	var maxi = Math.max(w1.length, w2.length);
	var res = 27*(maxi - mini);
	for (var i = 0; i < mini; i++) {
		res += Math.abs(w1[i].charCodeAt(0) - w2[i].charCodeAt(0));
	}
	return res;
}

function correct(w1, w2) {
	if (w1 == null) {
		return "_ _ _ _ _ _ _ _ _ ";
	}
	var mini = Math.min(w1.length, w2.length);
	var maxi = Math.max(w1.length, w2.length);
	var res = "";
	for (var i = 0; i < maxi; i++) {
		res += (w1[i] == w2[i] ? w1[i] : "_") + " ";
	}
	return res;
}

function reshape(w) {
	var res = "";
	for (var i = 0; i < w.length; i++) {
		res += w[i] + " ";
	}
	return res;
}

</script>